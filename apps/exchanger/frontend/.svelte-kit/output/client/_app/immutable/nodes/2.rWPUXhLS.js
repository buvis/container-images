import{g as Le,a as u,f as x,s as $,c as ye,t as Re,e as he}from"../chunks/BGC_O7Cu.js";import{i as ke}from"../chunks/CxezgJRR.js";import{R as ze,aE as We,aL as Ye,aM as He,A as qe,u as B,aN as Xe,aO as Se,aP as Be,F as Ge,aG as pe,aQ as Je,p as De,o as $e,a1 as Ke,t as H,b as Ce,s as _,c as s,d as g,r as t,g as e,m as N,f as fe,h as Ee,l as xe,a as Qe,e as _e,z as Ue,j as Ve,k as Ze}from"../chunks/D8SkQY_2.js";import{i as Z}from"../chunks/CCe7VU-t.js";import{s as me,e as le,i as ve}from"../chunks/BM-OiPN0.js";import{q as et,l as tt,h as at,s as Me,u as Oe}from"../chunks/sCxhiejC.js";import{s as Fe}from"../chunks/BuT9soB4.js";import{f as st}from"../chunks/BcTIPSpL.js";import{s as rt}from"../chunks/1CmXKqvd.js";import{p as we}from"../chunks/D5vEBnig.js";const nt=()=>performance.now(),ne={tick:r=>requestAnimationFrame(r),now:()=>nt(),tasks:new Set};function Ne(){const r=ne.now();ne.tasks.forEach(a=>{a.c(r)||(ne.tasks.delete(a),a.f())}),ne.tasks.size!==0&&ne.tick(Ne)}function it(r){let a;return ne.tasks.size===0&&ne.tick(Ne),{promise:new Promise(l=>{ne.tasks.add(a={c:r,f:l})}),abort(){ne.tasks.delete(a)}}}function be(r,a){Se(()=>{r.dispatchEvent(new CustomEvent(a))})}function ot(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const a=r.split("-");return a.length===1?a[0]:a[0]+a.slice(1).map(l=>l[0].toUpperCase()+l.slice(1)).join("")}function je(r){const a={},l=r.split(";");for(const c of l){const[i,T]=c.split(":");if(!i||T===void 0)break;const m=ot(i.trim());a[m]=T.trim()}return a}const lt=r=>r;function vt(r,a,l,c){var i=(r&Xe)!==0,T="both",m,S=a.inert,M=a.style.overflow,n,b;function D(){return Se(()=>m??=l()(a,c?.()??{},{direction:T}))}var A={is_global:i,in(){a.inert=S,be(a,"introstart"),n=Te(a,D(),b,1,()=>{be(a,"introend"),n?.abort(),n=m=void 0,a.style.overflow=M})},out(z){a.inert=!0,be(a,"outrostart"),b=Te(a,D(),n,0,()=>{be(a,"outroend"),z?.()})},stop:()=>{n?.abort(),b?.abort()}},R=ze;if((R.nodes.t??=[]).push(A),Le){var O=i;if(!O){for(var f=R.parent;f&&(f.f&We)!==0;)for(;(f=f.parent)&&(f.f&Ye)===0;);O=!f||(f.f&He)!==0}O&&qe(()=>{B(()=>A.in())})}}function Te(r,a,l,c,i){var T=c===1;if(Be(a)){var m,S=!1;return Ge(()=>{if(!S){var z=a({direction:T?"in":"out"});m=Te(r,z,l,c,i)}}),{abort:()=>{S=!0,m?.abort()},deactivate:()=>m.deactivate(),reset:()=>m.reset(),t:()=>m.t()}}if(l?.deactivate(),!a?.duration)return i(),{abort:pe,deactivate:pe,reset:pe,t:()=>c};const{delay:M=0,css:n,tick:b,easing:D=lt}=a;var A=[];if(T&&l===void 0&&(b&&b(0,1),n)){var R=je(n(0,1));A.push(R,R)}var O=()=>1-c,f=r.animate(A,{duration:M,fill:"forwards"});return f.onfinish=()=>{f.cancel();var z=l?.t()??1-c;l?.abort();var U=c-z,J=a.duration*Math.abs(U),ee=[];if(J>0){var y=!1;if(n)for(var h=Math.ceil(J/16.666666666666668),d=0;d<=h;d+=1){var w=z+U*D(d/h),E=je(n(w,1-w));ee.push(E),y||=E.overflow==="hidden"}y&&(r.style.overflow="hidden"),O=()=>{var C=f.currentTime;return z+U*D(C/J)},b&&it(()=>{if(f.playState!=="running")return!1;var C=O();return b(C,1-C),!0})}f=r.animate(ee,{duration:J,fill:"forwards"}),f.onfinish=()=>{O=()=>c,b?.(c,1-c),i()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=pe)},deactivate:()=>{i=pe},reset:()=>{c===0&&b?.(1,0)},t:()=>O()}}function Pe(r,a){Je(window,["resize"],()=>Se(()=>a(window[r])))}var dt=x('<div class="h-12 bg-slate-700 rounded"></div>'),ct=x('<div class="animate-pulse space-y-4"></div>'),ft=x('<div class="flex items-center justify-center py-8 text-slate-500"><span class="text-sm">No active tasks</span></div>'),ut=x('<span class="text-amber-400"> </span>'),pt=x('<div class="mb-2"><div class="h-2 bg-slate-700 rounded-full overflow-hidden"><div></div></div></div> <div class="flex justify-between items-center text-xs"><span class="text-slate-400"><!></span> <span class="text-blue-400 font-mono"> </span></div>',1),_t=x('<div class="flex justify-between items-center"><span class="text-xs text-slate-400 truncate max-w-[70%]"> </span> <span> </span></div>'),mt=x('<div class="bg-slate-900 p-4 rounded border border-slate-700"><div class="flex justify-between items-center mb-2"><span class="font-semibold text-white"> </span> <span class="text-xs text-slate-400"> </span></div> <!></div>'),gt=x('<div class="space-y-4"></div>'),xt=x('<div class="bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-bold text-white">Tasks</h2> <span class="flex items-center gap-1.5 text-xs"><span></span> <span class="text-slate-400"> </span></span></div> <!></div>');function bt(r,a){De(a,!1);let l=N([]),c=N(!0),i=null,T=1e3,m=null,S=N(!1),M=null;function n(y){if(!y)return null;const h=new Date(y).getTime(),d=Date.now(),w=Math.max(0,Math.ceil((h-d)/1e3));return w>0?`${w}s`:null}function b(){const y=location.protocol==="https:"?"wss:":"ws:";i=new WebSocket(`${y}//${location.host}/api/ws/tasks`),i.onopen=()=>{T=1e3,_(c,!1),_(S,!0),m&&clearTimeout(m),M&&clearInterval(M),M=setInterval(()=>{i?.readyState===WebSocket.OPEN&&i.send("ping")},25e3)},i.onmessage=h=>{const d=h.data;if(d==="ping"){i?.send("pong");return}if(d==="pong")return;const w=JSON.parse(d);_(l,Object.entries(w).map(([E,C])=>({name:E,...C})))},i.onerror=()=>{_(c,!1),_(S,!1)},i.onclose=()=>{_(S,!1),M&&(clearInterval(M),M=null),setTimeout(b,T),T=Math.min(T*2,3e4)}}$e(()=>{b(),m=setTimeout(()=>{_(c,!1)},3e3)}),Ke(()=>{i?.close(),m&&clearTimeout(m),M&&clearInterval(M)}),ke();var D=xt(),A=s(D),R=g(s(A),2),O=s(R),f=g(O,2),z=s(f,!0);t(f),t(R),t(A);var U=g(A,2);{var J=y=>{var h=ct();le(h,4,()=>Array(3),ve,(d,w)=>{var E=dt();u(d,E)}),t(h),u(y,h)},ee=y=>{var h=ye(),d=fe(h);{var w=C=>{var K=ft();u(C,K)},E=C=>{var K=gt();le(K,5,()=>e(l),ve,(o,v)=>{const I=Ee(()=>n(e(v).rate_limit_until));var j=mt(),q=s(j),L=s(q),te=s(L,!0);t(L);var ae=g(L,2),p=s(ae);t(ae),t(q);var P=g(q,2);{var se=F=>{var W=pt(),Y=fe(W),G=s(Y),k=s(G);let X;t(G),t(Y);var re=g(Y,2),Q=s(re),ue=s(Q);{var ie=de=>{var ce=ut(),Ie=s(ce);t(ce),H(()=>$(Ie,`Rate limited: ${e(I)??""}`)),u(de,ce)},oe=de=>{var ce=Re();H(()=>$(ce,e(v).message)),u(de,ce)};Z(ue,de=>{e(I)?de(ie):de(oe,!1)})}t(Q);var ge=g(Q,2),Ae=s(ge);t(ge),t(re),H(()=>{X=me(k,1,"h-full bg-blue-500 transition-all duration-300",null,X,{"animate-pulse":e(I)}),Fe(k,`width: ${e(v).progress??0??""}%`),$(Ae,`${e(v).progress??0??""}%`)}),u(F,W)},V=F=>{var W=_t(),Y=s(W),G=s(Y,!0);t(Y);var k=g(Y,2),X=s(k,!0);t(k),t(W),H(()=>{$(G,e(v).message),me(k,1,`text-xs px-2 py-1 rounded ${e(v).status==="error"?"bg-red-900 text-red-200":e(v).status==="done"?"bg-green-900 text-green-200":"bg-slate-800 text-slate-400"}`),$(X,e(v).status)}),u(F,W)};Z(P,F=>{e(v).status==="running"?F(se):F(V,!1)})}t(j),H(F=>{$(te,e(v).name),$(p,`Last: ${F??""}`)},[()=>st(e(v).last_run)||"Never"]),u(o,j)}),t(K),u(C,K)};Z(d,C=>{e(l).length===0?C(w):C(E,!1)},!0)}u(y,h)};Z(U,y=>{e(c)&&e(l).length===0?y(J):y(ee,!1)})}t(D),H(()=>{me(O,1,`w-2 h-2 rounded-full ${e(S)?"bg-green-500":"bg-red-500"}`),$(z,e(S)?"Live":"Reconnecting")}),u(r,D),Ce()}const ht=r=>r;function wt(r,{delay:a=0,duration:l=400,easing:c=ht}={}){const i=+getComputedStyle(r).opacity;return{delay:a,duration:l,easing:c,css:T=>`opacity: ${T*i}`}}var yt=x('<div role="img"></div>'),Tt=x('<div class="flex flex-col gap-1"></div>'),kt=x('<span class="px-1.5 py-0.5 bg-red-500/10 text-red-300 rounded border border-red-500/20 text-[10px] font-mono"> </span>'),St=x('<div class="flex items-center justify-between mb-1.5"><span class="text-red-400 font-medium">Missing</span> <span class="bg-slate-800 text-slate-400 px-1 rounded text-[10px]"> </span></div> <div class="flex flex-wrap gap-1 max-h-32 overflow-y-auto pr-1"></div>',1),Dt=x('<div class="text-emerald-400 flex items-center gap-1.5 py-1"><svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> <span>All symbols present</span></div>'),Ct=x('<span class="text-slate-400">No data</span>'),Mt=x('<span class="text-yellow-400"> </span>'),Ot=x('<div class="fixed z-50 w-[200px] bg-slate-900 border border-slate-600 rounded-md shadow-2xl pointer-events-none text-xs text-slate-200 flex flex-col overflow-hidden"><div class="bg-slate-800 p-2 border-b border-slate-700 flex justify-between items-center"><span class="font-bold text-slate-100"> </span> <span class="font-mono text-slate-400"> </span></div> <div class="p-2 bg-slate-900/95 backdrop-blur-sm"><!></div></div>'),jt=x('<div class="bg-slate-800 rounded-lg shadow-lg p-4 border border-slate-700 overflow-x-auto"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-200 font-bold text-sm">Data Coverage</h3> <div class="flex items-center gap-2 text-xs text-slate-400"><span class="flex items-center gap-1"><span class="w-3 h-3 bg-slate-700 rounded-sm"></span> Missing</span> <span class="flex items-center gap-1"><span class="w-3 h-3 bg-yellow-500 rounded-sm"></span> Partial</span> <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-sm"></span> Complete</span></div></div> <div class="flex gap-1"></div></div> <!>',1);function Pt(r,a){De(a,!1);const l=N(),c=N(),i=N(),T=N();let m=we(a,"coverage",24,()=>({})),S=we(a,"favoritesCount",8,0),M=we(a,"missingSymbols",24,()=>({})),n=N(null),b=N(0),D=N(0),A=N(0),R=N(0);const O=200,f=15;function z(o){return o===0?!1:S()>0?o>=S():e(i)===1?!0:o/e(i)>=.8}function U(o){const v=[],I=new Date,j=new Date(I);j.setDate(I.getDate()-370);for(let q=0;q<371;q++){const L=new Date(j);L.setDate(j.getDate()+q);const te=L.getTimezoneOffset()*6e4,p=new Date(L.getTime()-te).toISOString().split("T")[0];v.push({date:p,month:L.getMonth(),day:L.getDate(),value:o[p]||0})}return v}function J(o){return o===0?"bg-slate-700":S()>0?o>=S()?"bg-green-500":"bg-yellow-500":e(i)===1?"bg-green-500":o/e(i)<.8?"bg-yellow-500":"bg-green-500"}function ee(o,v){_(n,{...v,missing:M()[v.date]||[]}),_(b,o.clientX),_(D,o.clientY)}function y(o){_(b,o.clientX),_(D,o.clientY)}function h(){_(n,null)}xe(()=>(e(b),e(A)),()=>{_(l,e(b)+O+f>e(A)?e(b)-O-f:e(b)+f)}),xe(()=>(e(D),e(R)),()=>{_(c,Math.max(0,e(D)+200>e(R)?e(D)-10:e(D)+f))}),xe(()=>_e(m()),()=>{_(i,Math.max(...Object.values(m()),1))}),xe(()=>_e(m()),()=>{_(T,U(m()))}),Qe(),ke();var d=jt(),w=fe(d),E=g(s(w),2);le(E,4,()=>Array(53),ve,(o,v,I)=>{var j=Tt();le(j,4,()=>Array(7),ve,(q,L,te,ae)=>{const p=Ee(()=>(e(T),B(()=>e(T)[I*7+te])));var P=yt();H(se=>{me(P,1,`w-3 h-3 rounded-sm ${se??""} hover:ring-1 hover:ring-white transition-all duration-75 cursor-default`),rt(P,"aria-label",`${_e(e(p)),B(()=>e(p).date)??""}: ${_e(e(p)),B(()=>e(p).value)??""} rates`)},[()=>(_e(e(p)),B(()=>J(e(p).value)))]),he("mouseenter",P,se=>ee(se,e(p))),he("mousemove",P,y),he("mouseleave",P,h),u(q,P)}),t(j),u(o,j)}),t(E),t(w);var C=g(w,2);{var K=o=>{var v=Ot(),I=s(v),j=s(I),q=s(j,!0);t(j);var L=g(j,2),te=s(L,!0);t(L),t(I);var ae=g(I,2),p=s(ae);{var P=V=>{var F=St(),W=fe(F),Y=g(s(W),2),G=s(Y,!0);t(Y),t(W);var k=g(W,2);le(k,5,()=>(e(n),B(()=>e(n).missing)),ve,(X,re)=>{var Q=kt(),ue=s(Q,!0);t(Q),H(()=>$(ue,e(re))),u(X,Q)}),t(k),H(()=>$(G,(e(n),B(()=>e(n).missing.length)))),u(V,F)},se=V=>{var F=ye(),W=fe(F);{var Y=k=>{var X=Dt();u(k,X)},G=k=>{var X=ye(),re=fe(X);{var Q=ie=>{var oe=Ct();u(ie,oe)},ue=ie=>{var oe=Mt(),ge=s(oe);t(oe),H(()=>$(ge,`${e(n),B(()=>e(n).value)??""}/${(S()>0?S():e(i))??""} symbols`)),u(ie,oe)};Z(re,ie=>{e(n),B(()=>e(n).value===0)?ie(Q):ie(ue,!1)},!0)}u(k,X)};Z(W,k=>{e(n),B(()=>z(e(n).value))?k(Y):k(G,!1)},!0)}u(V,F)};Z(p,V=>{e(n),B(()=>e(n).missing.length>0)?V(P):V(se,!1)})}t(ae),t(v),H(()=>{Fe(v,`top: ${e(c)??""}px; left: ${e(l)??""}px;`),$(q,(e(n),B(()=>e(n).date))),$(te,(e(n),B(()=>e(n).value)))}),vt(3,v,()=>wt,()=>({duration:150})),u(o,v)};Z(C,o=>{e(n)&&o(K)})}Pe("innerWidth",o=>_(A,o)),Pe("innerHeight",o=>_(R,o)),u(r,d),Ce()}var $t=x('<div class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-medium bg-slate-700/30 border border-slate-700/50"><span class="text-slate-200 mr-1.5 font-semibold"> </span> <span class="text-slate-400 uppercase tracking-wider"> </span></div>'),Et=x('<div class="flex flex-wrap gap-2"></div>'),Ft=x('<div class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.4)]"></div>'),Nt=x('<div class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]" title="No symbols configured"></div>'),At=x('<div class="flex flex-col sm:flex-row sm:items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg gap-3 transition-colors hover:bg-slate-800/70"><div class="flex flex-col gap-2"><span class="text-sm font-medium text-white"> </span> <!></div> <div class="flex items-center gap-3 shrink-0 self-end sm:self-auto"><span class="text-xs text-slate-500"><span class="text-slate-300 font-semibold"> </span> total</span> <!></div></div>'),It=x('<div class="bg-slate-950 text-slate-100 p-8"><header class="flex items-center justify-between mb-8"><h1 class="text-3xl font-bold text-white">Status</h1> <div class="flex items-center gap-2 bg-slate-900 px-4 py-2 rounded-full border border-slate-800"><div></div> <span class="text-sm font-medium uppercase tracking-wider"> </span></div></header> <div class="mb-8"><!></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!> <div class="bg-slate-900 rounded-xl border border-slate-800 p-4"><h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">Providers</h3> <div class="space-y-2"></div></div></div></div>');function Jt(r,a){De(a,!1);let l=N("loading"),c=N([]),i=N({}),T=N({}),m=N([]);async function S(){try{const[y,h]=await Promise.all([et(),tt()]);_(l,y.status),_(m,h),_(c,await at());const d=e(c).map(v=>v.provider_symbol),w=new Date().getFullYear(),[E,C,K,o]=await Promise.all([Me(w,void 0,d.length?d:void 0),Me(w-1,void 0,d.length?d:void 0),d.length?Oe(w,d):Promise.resolve({}),d.length?Oe(w-1,d):Promise.resolve({})]);_(i,{...C,...E}),_(T,{...o,...K})}catch(y){console.error("Failed to load dashboard data",y),_(l,"offline")}}$e(()=>{S()}),ke();var M=It(),n=s(M),b=g(s(n),2),D=s(b),A=g(D,2),R=s(A,!0);t(A),t(b),t(n);var O=g(n,2),f=s(O);Pt(f,{get coverage(){return e(i)},get missingSymbols(){return e(T)},get favoritesCount(){return e(c).length}}),t(O);var z=g(O,2),U=s(z);bt(U,{});var J=g(U,2),ee=g(s(J),2);le(ee,5,()=>e(m),ve,(y,h)=>{var d=At(),w=s(d),E=s(w),C=s(E,!0);t(E);var K=g(E,2);{var o=p=>{var P=Et();le(P,5,()=>Object.entries(e(h).symbol_counts_by_type),ve,(se,V)=>{var F=Ve(()=>Ze(e(V),2));let W=()=>e(F)[0],Y=()=>e(F)[1];var G=$t(),k=s(G),X=s(k,!0);t(k);var re=g(k,2),Q=s(re,!0);t(re),t(G),H(()=>{$(X,Y()),$(Q,W())}),u(se,G)}),t(P),u(p,P)};Z(K,p=>{Object.keys(e(h).symbol_counts_by_type).length>0&&p(o)})}t(w);var v=g(w,2),I=s(v),j=s(I),q=s(j,!0);t(j),Ue(),t(I);var L=g(I,2);{var te=p=>{var P=Ft();u(p,P)},ae=p=>{var P=Nt();u(p,P)};Z(L,p=>{e(h).symbol_count>0?p(te):p(ae,!1)})}t(v),t(d),H(()=>{$(C,e(h).name),$(q,e(h).symbol_count)}),u(y,d)}),t(ee),t(J),t(z),t(M),H(()=>{me(D,1,`w-3 h-3 rounded-full ${e(l)==="ok"?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":e(l)==="loading"?"bg-slate-500 animate-pulse":"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]"}`),$(R,e(l))}),u(r,M),Ce()}export{Jt as component};
